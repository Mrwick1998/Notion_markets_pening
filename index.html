<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Börsenstatus – Flags (DE-Zeit)</title>

  <!-- Nur Luxon für Zeitzonen/DST -->
  <script src="https://unpkg.com/luxon@3/build/global/luxon.min.js"></script>

  <style>
    :root{
      --green:#17c964;
      --red:#f21361;
      --bg: transparent;
      --panel: rgba(255,255,255,.9);
      --text: #111;
      --muted:#666;
      --radius:10px;
      --shadow:0 5px 15px rgba(0,0,0,.1);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --panel: rgba(24,24,24,.9);
        --text:#eee;
        --muted:#aaa;
        --shadow:0 5px 20px rgba(0,0,0,.5);
      }
    }

    html,body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    .wrap{
      max-width:800px;            /* schmal, damit es in Notion ohne Scroll passt */
      margin:0 auto;
      padding:10px;
      text-align:center;
    }

    h1{ font-size:16px; margin:0 0 4px; }
    .sub{ margin:0 0 10px; color:var(--muted); font-size:12px; }

    .livebar{ font-size:10px; color:var(--muted); margin-bottom:10px; }
    .pill{ display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px;
           background:rgba(23,201,100,.18); border:1px solid rgba(23,201,100,.35); color:#022b14; font-size:10px; font-weight:800; }
    .pill .dot{ width:8px; height:8px; border-radius:50%; background:var(--green); }
    @keyframes pulse{0%{transform:scale(1)}70%{transform:scale(1.05)}100%{transform:scale(1)}}
    .pill.blink .dot{ animation:pulse 1.1s ease-out; }
    .updated{ margin-left:8px; }

    .grid{
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:10px;
    }

    .card{
      background:var(--panel);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:6px;
      border:2px solid transparent;
      width:150px;                /* << klein & gleichmäßig */
      transition:border-color .2s ease;
    }
    .card.open{   border-color:rgba(23,201,100,.8); }
    .card.closed{ border-color:rgba(242,19,97,.8); }

    .flag{
      width:100%; height:auto; border-radius:6px; margin-bottom:6px;
      display:block;
    }

    .name{ font-weight:600; font-size:12px; margin-bottom:2px; }
    .badge{
      font-weight:700; font-size:10px; padding:2px 6px; border-radius:999px; border:1px solid transparent; display:inline-block;
    }
    .badge.open{   color:#022b14; background:rgba(23,201,100,.18); border-color:rgba(23,201,100,.3); }
    .badge.closed{ color:#2b020f; background:rgba(242,19,97,.16); border-color:rgba(242,19,97,.3); }

    .meta{ font-size:10px; line-height:1.3; color:var(--muted); }
    .meta strong{ color:var(--text); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Börsenstatus – London • New York • Tokyo • Sydney</h1>
    <p class="sub">Zeiten in <strong>deutscher Zeit (Europe/Berlin)</strong>, inkl. Sommer-/Winterzeit. Aktualisierung jede Minute. (Feiertage ignoriert)</p>

    <div class="livebar">
      <span id="live" class="pill"><span class="dot"></span> LIVE</span>
      <span id="updated" class="updated">Zuletzt aktualisiert: –</span>
    </div>

    <div id="grid" class="grid"></div>
  </div>

  <script>
    // === Daten ===
    const TARGET_TZ = "Europe/Berlin"; // Anzeige-Zeitzone (DE)
    const DateTime = luxon.DateTime;

    // 4 Börsen – Öffnungszeiten in LOKALER Börsenzeit
    const EXCHANGES = [
      { key:"london",  name:"London Stock Exchange (LSE)", city:"London",  flag:"https://flagcdn.com/w320/gb.png", tz:"Europe/London",      open:"08:00", close:"16:30", weekdays:[1,2,3,4,5] },
      { key:"newyork", name:"New York (NYSE & Nasdaq)",   city:"New York", flag:"https://flagcdn.com/w320/us.png", tz:"America/New_York",   open:"09:30", close:"16:00", weekdays:[1,2,3,4,5] },
      { key:"tokyo",   name:"Tokyo Stock Exchange (TSE)", city:"Tokyo",    flag:"https://flagcdn.com/w320/jp.png", tz:"Asia/Tokyo",         open:"09:00", close:"15:00", weekdays:[1,2,3,4,5] },
      { key:"sydney",  name:"Sydney (ASX)",               city:"Sydney",   flag:"https://flagcdn.com/w320/au.png", tz:"Australia/Sydney",   open:"10:00", close:"16:00", weekdays:[1,2,3,4,5] }
    ];

    // === Zeit-Helfer ===
    function parseHM(t){ const [h,m]=t.split(":").map(Number); return {h, m}; }

    // prüft "jetzt" in der lokalen Börsenzeit
    function isOpenNow(ex, nowUtc = DateTime.utc()){
      const localNow = nowUtc.setZone(ex.tz);
      if(!ex.weekdays.includes(localNow.weekday)) return {open:false, localNow};
      const {h:oh,m:om} = parseHM(ex.open);
      const {h:ch,m:cm} = parseHM(ex.close);
      const openT  = localNow.set({hour:oh, minute:om, second:0, millisecond:0});
      const closeT = localNow.set({hour:ch, minute:cm, second:0, millisecond:0});
      return { open: localNow >= openT && localNow <= closeT, localNow, openT, closeT };
    }

    // Öffnungsfenster "heute" in DE-Zeit anzeigen
    function todaysWindowDE(ex, nowUtc = DateTime.utc()){
      const localBase = nowUtc.setZone(ex.tz);
      const {h:oh,m:om} = parseHM(ex.open);
      const {h:ch,m:cm} = parseHM(ex.close);
      const openLocal  = localBase.set({hour:oh, minute:om, second:0, millisecond:0});
      const closeLocal = localBase.set({hour:ch, minute:cm, second:0, millisecond:0});
      return `${openLocal.setZone(TARGET_TZ).toFormat("HH:mm")} – ${closeLocal.setZone(TARGET_TZ).toFormat("HH:mm")}`;
    }

    function nextChangeDE(ex, nowUtc = DateTime.utc()){
      const st = isOpenNow(ex, nowUtc);
      if(st.open){
        return {label:"schließt um", time: st.closeT.setZone(TARGET_TZ).toFormat("HH:mm")};
      } else {
        const localNow = nowUtc.setZone(ex.tz);
        for(let d=0; d<10; d++){
          const cand = localNow.plus({days:d});
          if(ex.weekdays.includes(cand.weekday)){
            const {h:oh,m:om} = parseHM(ex.open);
            const openC = cand.set({hour:oh, minute:om, second:0, millisecond:0});
            if(d>0 || localNow < openC) return {label:"öffnet um", time: openC.setZone(TARGET_TZ).toFormat("HH:mm")};
          }
        }
        return {label:"öffnet um", time:"—"};
      }
    }

    // === Rendering ===
    const grid  = document.getElementById('grid');
    const liveEl= document.getElementById('live');
    const updEl = document.getElementById('updated');

    function cardHTML(ex, st, windowDE, nxt, nowDE){
      const badge = st.open ? `<span class="badge open">OPEN</span>` : `<span class="badge closed">CLOSED</span>`;
      const cls   = st.open ? 'card open' : 'card closed';
      return `
        <div class="${cls}" id="card-${ex.key}">
          <img class="flag" src="${ex.flag}" alt="Flagge ${ex.city}">
          <div class="name">${ex.name}</div>
          ${badge}
          <div class="meta">
            <div><strong>Ort:</strong> ${ex.city} · <strong>TZ:</strong> ${ex.tz}</div>
            <div><strong>Heute (DE):</strong> ${windowDE}</div>
            <div><strong>Jetzt (DE):</strong> ${nowDE}</div>
            <div><strong>Nächster Wechsel:</strong> ${nxt.label} ${nxt.time}</div>
          </div>
        </div>
      `;
    }

    function update(){
      const nowUtc = DateTime.utc();
      const nowDE  = nowUtc.setZone(TARGET_TZ).toFormat("EEE, dd.LL, HH:mm");
      grid.innerHTML = EXCHANGES.map(ex=>{
        const st = isOpenNow(ex, nowUtc);
        const w  = todaysWindowDE(ex, nowUtc);
        const nx = nextChangeDE(ex, nowUtc);
        return cardHTML(ex, st, w, nx, nowDE);
      }).join("");

      // LIVE
      updEl.textContent = "Zuletzt aktualisiert: " + nowUtc.setZone(TARGET_TZ).toFormat("dd.LL.yyyy HH:mm:ss 'Uhr'");
      liveEl.classList.add('blink'); setTimeout(()=>liveEl.classList.remove('blink'),1100);
    }

    update();
    setInterval(update, 60*1000);
  </script>
</body>
</html>